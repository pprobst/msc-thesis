% -*- mode: latex; coding: utf-8 -*-
\input{blocksworld.tex}

%\documentclass{gkibeamer}
\documentclass{beamer}

\usepackage{tikz}
\usepackage{ifthen}
\usepackage{stmaryrd}
\usepackage[T1]{fontenc}
\usepackage[brazil]{babel}
\usepackage[utf8]{inputenc}
%\usetheme{Inf}
%\usetheme{}
\usecolortheme{rose}

\usepackage{amsthm}
\newtheorem{definicao}{Definição}[section] % Redefinindo o ambiente "definition" como "definicao"

%\setbeamertemplate{footline}[frame number]
\setbeamertemplate{footline}{%
  \begin{beamercolorbox}[wd=\paperwidth,ht=2.25ex,dp=2ex]{author in head/foot}%
    \usebeamerfont{author in head/foot}%
    \hfill 
    \hspace*{1em} \insertframenumber\hspace*{1em} % Only display current page number
  \end{beamercolorbox}%
}

\setbeamertemplate{navigation symbols}{}

\title[Discovering and Learning Preferred Operators]{Discovering and Learning Preferred Operators for Classical Planning with Neural Networks}
\author{Pedro Probst Minini}

%\institute{Federal University of Rio Grande do Sul\\Institute of Informatics\\Department of Theoretical Informatics}
%\subject{AI}

\input{macros}

% #############################################################################################################
%
%% Needed for "Content of this Course" slide in most chapters:
\usetikzlibrary{positioning, calc, decorations.pathreplacing, arrows, arrows.meta, patterns, automata}
\usepackage[outline]{contour} % glow around text
\contourlength{1.4pt}
\tikzset{>=latex} % for LaTeX arrow head
\colorlet{myred}{red!80!black}
\colorlet{myblue}{blue!80!black}
\colorlet{mygreen}{green!60!black}
\colorlet{myorange}{orange!70!red!60!black}
\colorlet{mydarkred}{red!30!black}
\colorlet{mydarkblue}{blue!40!black}
\colorlet{mydarkgreen}{green!30!black}
\tikzset{ % node styles, numbered for easy mapping with \nstyle
  my nodes/.style={circle,inner sep=0,minimum size=8mm},
  input/.style={my nodes,draw=mygreen,fill=mygreen!20,text=green!50!black},
  hidden/.style={my nodes,draw=violet,fill=violet!20,text=violet},
  output/.style={my nodes,draw=myred!60!black,fill=myred!20,text=red!60!black},
  my text/.style={text=#1,text width=1cm,align=center}
}

\usepackage[linesnumbered, ruled, vlined]{algorithm2e}
\usepackage{mathtools}
\usepackage{booktabs}
\usepackage{comment}
\usepackage{multicol}
%\usepackage{natbib}
\usepackage{cancel}
\usepackage[citestyle=authoryear,maxnames=10,maxcitenames=1,giveninits=true,backend=biber,uniquelist=false]{biblatex}
\usepackage[utf8]{inputenc}
\usepackage[textsize=tiny,colorinlistoftodos,prependcaption]{todonotes}
\addbibresource{biblio.bib}

\newcommand{\pp}[2][noinline]{\todo[color=purple!50,linecolor={purple!100},#1,fancyline,author=Pedro]{#2}}
\newcommand{\ppi}[2][inline]{\todo[color=purple!50,linecolor={purple!100},#1,fancyline,author=Pedro]{#2}}

% #####################
\AtBeginSubsection[]
{
\begin{frame}[noframenumbering]
    %\frametitle{\n}
    \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
      \usebeamerfont{title}\insertsectionhead\par%
    \end{beamercolorbox}
    \tableofcontents[currentsection,currentsubsection]
\end{frame}
}

\AtBeginSection[]{
  \begin{frame}
    \setbeamercolor{section title}{fg=beamer@blendedblue,bg=structure}
    \usebeamercolor[fg]{section title}
    \centering
    \Huge\insertsectionhead
  \end{frame}
}
% #####################

\addbibresource{biblio.bib}

% #############################################################################################################

%\subtitle{Some title}
%\date{}
%\begin{document}

%\begin{frame}{Outline}
%\tableofcontents
%\end{frame}

% Define the title with \title[short title]{long title}
% Short title is optional
\title[Discovering and Learning Preferred Operators]
      {Discovering and Learning Preferred Operators for Classical Planning with Neural Networks}

% Optional subtitle
%\subtitle{Defesa de Mestrado}

\date{3 de julho de 2023}

% Author information
\author{Pedro Probst Minini \\ \vspace{0.3cm} Orientador: Marcus Ritt \\ Coorientador: André G. Pereira}
\institute{Instituto de Informática --- UFRGS}

\begin{document}

% Command to create title page (INF)
%\InfTitlePage

\begin{frame}[plain]
  \titlepage
\end{frame}

\begin{frame}{Outline}
  \frametitle{Agenda}
  \tableofcontents
\end{frame}

\section{Problema}
\begin{frame}{O Que Queremos Fazer?}
Planejadores que usam operadores preferidos para \alert{priorizar a expansão de estados mais promissores} foram os vencedores da trilha \emph{satisficing} da \emph{International Planning Competition} (IPC) em \alert{2004}~(\cite{Helmert/2006}), \alert{2008}~(\cite{Richter.lama.etal/2010}), \alert{2011}~(\cite{Richter.lama.etal/2011}), and \alert{2018}~(\cite{Seipp-fast.etal/2018}).

\pause
\begin{itemize}
  \item Abordagens existentes para a derivação de operadores preferidos são baseadas em lógica (e.g. operadores preferidos do FF).
  \pause
  \item Há vários métodos para o aprendizado de funções heurísticas usando redes neurais.
  \begin{itemize}
    \item Mas nada sobre aprender operadores preferidos.
  \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{O Que Queremos Fazer?}
\begin{itemize}
  \item Propomos um método para gerar amostras de estados, onde \alert{cada estado tem um conjunto de operadores preferidos}.
  \pause
  \item Usamos esses conjuntos de amostras gerados para \alert{treinar redes neurais} que, durante a resolução de um problema de planejamento, predizem operadores preferidos para o estado atual.
\end{itemize}
%\pause
%\begin{align*}
%\centering
%&(\text{valor-}h;\text{estado};\text{operadores preferidos}) \\
%&16;00000001011110110\ldots0000000100000001;71 \\
%&17;00000001010110100\ldots0000000100000001;8,20 \\
%&\ldots \\
%&14;00000001010100110\ldots0000010000100000;93,60 \\
%&13;00000001011100000\ldots0000010010000000;13 \\
%&\ldots
%\end{align*}
\end{frame}


\section{Introdução}

\subsection{Planejamento}
\begin{frame}{Planejamento Clássico}
\emph{Planejamento} tem o objetivo de encontrar uma \alert{sequência de ações} a partir de um \alert{estado inicial} que satisfaça as \alert{condições objetivo}.
    \begin{exampleblock}{\strut Exemplo: Planejamento Clássico}
      \hilite{ambiente}
      \begin{itemize}
      \item \alert{estático} vs.\ \grey{dinâmico}
      \item \alert{determinístico} vs.\ \grey{não determinístico}
        vs.\ \grey{estocástico}
      \item \alert{observável}
        vs.\ \grey{parcialmente observável}
        vs.\ \grey{não observável}
      \item \alert{discreto} vs.\ \grey{contínuo}
      \item \alert{agente único} vs.\ \grey{agentes multiplos}
      \end{itemize}

      %\pause
      %\hilite{método de resolução}
      %\begin{itemize}
      %\item \grey{específico por problema} vs.\ \alert{geral} vs.\ \orange{aprendizado}
      %\end{itemize}
    \end{exampleblock}
% ppi{Then briefly talk about non-deterministic planning.}
% Classical Planning is an example of a "model".
\end{frame}

\begin{frame}{STRIPS}
  \begin{definicao}[Um problema de planejamento em STRIPS]
    $\Pi = \langle F, O, s_{0}, s^{*}\rangle$ onde
    \begin{itemize}
        \item $F$ é um conjunto de variáveis booleanas (\alert{fatos} ou \alert{proposições}),
        \item $O$ é um conjunto de \alert{operadores} ou ações sobre $F$, onde $\langle pre(o), add(o), del(o) \rangle \subseteq F$,
        \item $s_{0} \subseteq F$ é o conjunto de fatos que representa o \alert{estado inicial}, e
        \item $s^{*} \subseteq F$ é o conjunto de fatos que devem ser satisfeitos (``\alert{gol}'').
    \end{itemize}
   \pause
    As ações $O(s)$ são \alert{aplicáveis} em $s$ se elas satisfizerem $pre(o)$.

    Avançamos de um estado $s$ com o operador $o$ definindo os add-effects como \alert{verdadeiros} e os del-effects como \alert{falsos}.
    %\pause
    %Por fim, $\pi = o_{1}, o_{2},\ldots, o_{n}$ é chamado de \alert{plano} para $\Pi$, em que $o_{i}$ é um operador aplicável.
\end{definicao}
%Planning tasks are usually formally described in PDDL files, following a Lisp-like structure.
\end{frame}

\begin{frame}{Exemplo: Blocks World}
%\begin{figure}
%    \centering
%    \includegraphics[width=7cm]{img/blocksworld1.png}
%    \caption{Uma tarefa de planejamento do domínio Blocks World.}
%\end{figure}

\begin{figure}[ht]
\caption[]{Configuração inicial e objetivo de uma tarefa Blocks World.}
\centering
\begin{tikzpicture}
  % Initial state
  \node[align=center] at (7.5,-0.3) {(Estado inicial)};
  \drawCube{7}{0.5}{0}{A}{red}{0.7}
  \drawCube{7}{1.2}{0}{C}{green}{0.7}
  \drawCube{7.7}{0.5}{0}{B}{blue}{0.7}

  % Goal state
  \node[align=center] at (11.2,-0.3) {(Estado final)};
  \drawCube{11}{0.5}{0}{B}{blue}{0.7}
  \drawCube{11}{1.2}{0}{C}{green}{0.7}
  \drawCube{11}{1.9}{0}{A}{red}{0.7}
\end{tikzpicture}
\end{figure}
\end{frame}

\begin{frame}{Exemplo: Blocks World}
% This is from Malte Helmert's slides, slightly modified.
    \begin{exampleblock}{\strut Exemplo: Blocks World}
      \hilite{$\Pi = \langle F, O, s_{0}, s^{*}\rangle$}
      \begin{itemize}
      \item $F$ = \{on(a,b), on(a,c), on(b,a), on(b,c), on(c,a), on(c,b), on-table(a), on-table(b), on-table(c), clear(a), clear(b), clear(c)\}

       \item $O$ = \{move(a,b,c), move(a,c,b), move(b,a,c), move(b,c,a), move(c,a,b), move(c,b,a), to-table(a,b), to-table(a,c), to-table(b,a), to-table(b,c), to-table(c,a), to-table(c,b), from-table(a,b), from-table(a,c), from-table(b,a), from-table(b,c), from-table(c,a), from-table(c,b)\}

        \item $s_{0}$ = \{on(c,a), on-table(a), on-table(b), clear(c), clear(b)\}

         \item $s^{*}$ = \{on(c,b), on(a,c)\}
      \end{itemize}
    \end{exampleblock}
\end{frame}

\begin{frame}{Exemplo: Blocks World}
    \begin{exampleblock}{\strut Exemplo: Blocks World}
      \begin{itemize}
      \item \emph{move(x,y,z)}: mover bloco x sobre y para cima de z.
      \begin{itemize}
        \item Pre(move(a,b,c)) = \{on(a,b), clear(a), clear(c)\}
        \item Add(move(a,b,c)) = \{on(a,c), clear(b)\}
        \item Del(move(a,b,c)) = \{on(a,b), clear(c)\}
        \item Com base no estado inicial, essa ação é aplicável? % Não, ela não satisfaz as condições prévias.
      \end{itemize}
      \item \emph{to-table}(x,y): mover bloco x sobre y para a mesa.
      \item \emph{from-table}(x,y): mover bloco x da mesa para cima de y.
      \end{itemize}
    \end{exampleblock}
\end{frame}

\begin{frame}{Espaço de Estados do Blocks World com 3 Blocos}
  \begin{center}
    \begin{pgfpicture}{-39mm}{-32.4mm}{39mm}{32.4mm}
      \pgfnodebox{RsGsB}[virtual]{\pgfpolar{0}{0cm}}{\RsGsB}{2pt}{2pt}

      \pgfnodebox{RGsB}[virtual]{\pgfpolar{0}{16mm}}{\RGsB}{2pt}{2pt}
      \pgfnodebox{RBsG}[virtual]{\pgfpolar{60}{16mm}}{\RBsG}{2pt}{2pt}
      \pgfnodebox{BRsG}[virtual]{\pgfpolar{120}{16mm}}{\BRsG}{2pt}{2pt}
      \pgfnodebox{RsBG}[virtual]{\pgfpolar{180}{16mm}}{\RsBG}{2pt}{2pt}
      \pgfnodebox{RsGB}[virtual]{\pgfpolar{240}{16mm}}{\RsGB}{2pt}{2pt}
      \pgfnodebox{GRsB}[virtual]{\pgfpolar{300}{16mm}}{\GRsB}{2pt}{2pt}

      \pgfnodebox{BRG}[virtual]{\pgfpolar{0}{32mm}}{\BRG}{2pt}{2pt}
      \pgfnodebox{GRB}[virtual]{\pgfpolar{50}{32mm}}{\GRB}{2pt}{2pt}
      \pgfnodebox{GBR}[virtual]{\pgfpolar{130}{32mm}}{\GBR}{2pt}{2pt}
      \pgfnodebox{RBG}[virtual]{\pgfpolar{180}{32mm}}{\RBG}{2pt}{2pt}
      \pgfnodebox{RGB}[virtual]{\pgfpolar{230}{32mm}}{\RGB}{2pt}{2pt}
      \pgfnodebox{BGR}[virtual]{\pgfpolar{310}{32mm}}{\BGR}{2pt}{2pt}

      \pgfsetendarrow{\pgfarrowtriangle{5pt}}
      \pgfsetstartarrow{\pgfarrowtriangle{5pt}}

      \pgfnodeconnline{RsGsB}{RGsB}
      \pgfnodeconnline{RsGsB}{RBsG}
      \pgfnodeconnline{RsGsB}{BRsG}
      \pgfnodeconnline{RsGsB}{RsBG}
      \pgfnodeconnline{RsGsB}{RsGB}
      \pgfnodeconnline{RsGsB}{GRsB}

      \pgfnodeconnline{RGsB}{BRG}
      \pgfnodeconnline{RBsG}{GRB}
      \pgfnodeconnline{BRsG}{GBR}
      \pgfnodeconnline{RsBG}{RBG}
      \pgfnodeconnline{RsGB}{RGB}
      \pgfnodeconnline{GRsB}{BGR}

      \pgfnodeconnline{RGsB}{RBsG}
      \pgfnodeconnline{BRsG}{RsBG}
      \pgfnodeconnline{RsGB}{GRsB}
    \end{pgfpicture}
  \end{center}
\end{frame}

%\begin{frame}{\sas}
%\begin{itemize}
%\item \sas é similar a STRIPS, mas variáveis têm domínios finitos, não sendo necessariamente binárias.
%  \item O estado inicial $s_{0}$ é tipicamente um \alert{estado completo}, i.e., todas as variáveis estão definidas.
%  \item O gol $s^{*}$ é definido \alert{parcialmente}, com certas variáveis indefinidas ($\bot$).
%\end{itemize}
%\end{frame}

\subsection{Busca Heurística}
\begin{frame}{Busca Heurística}
\begin{itemize}
  \item Num problema de planejamento, um estado $s$ tem uma função heurística \alert{$h(s)$}, dado por uma função heurística $h$, que estima o \alert{custo de atingir o gol $s^{*}$} a partir de $s$.
  \begin{itemize}
    \item A heurística perfeita \alert{$\hstar(s)$} é a \alert{distância real} de $s$ até $s^{*}$.
  \end{itemize}
  \pause
  \item Planejadores tipicamente buscam satisfazer o gol \alert{priorizando} estados no espaço de estados com \alert{menor função heurística}.
  \begin{itemize}
    \item Idealmente tentando preservar o ranking de expansões de \hstar.
  \end{itemize}
  \pause
  \item Algoritmos ``best-first search'', e.g., greedy best-first serach (GBFS), \astar.
\end{itemize}
\end{frame}

\begin{frame}{Busca Heurística: Exemplo com GBFS}
\only<1> {
\begin{figure}[tb]
\centering
\begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
    ]

  \node[black_node,label=above:{\footnotesize$2$}] (A) at (0,0) {\footnotesize$s_0$};
  \node[black_node,label=above:{\footnotesize$3$}] (B) at (-1.7,-1) {\footnotesize$s_{1}$};
  \node[black_node,label=above:{\footnotesize$1$}] (C) at (1.7,-1) {\footnotesize$s_{2}$};
  \node[black_node,label=above:{\footnotesize$4$}] (D) at (-2.7,-2) {\footnotesize$s_{3}$};
  \node[black_node,label=above:{\footnotesize$4$}] (E) at (-0.7,-2) {\footnotesize$s_{4}$};
  \node[black_node,label=above:{\footnotesize$2$}] (F) at (0.7,-2) {\footnotesize$s_{5}$};
  \node[black_node, accepting,label=above:{\footnotesize$0$}] (G) at (2.7,-2) {\footnotesize$s^{*}$};

  \draw (A) -- (B);
  \draw (A) -- (C);
  \draw (B) -- (D);
  \draw (B) -- (E);
  \draw (C) -- (F);
  \draw (C) -- (G);
\end{tikzpicture}
\end{figure}

\begin{table}[b]
\centering
\begin{tabular}{|c|c|}
\hline
\textbf{Iteração} & \textbf{Fila de Prioridades} \\
\hline
0 & ($s_{0}$, 2) \\
\hline
\end{tabular}
\end{table}
}

\only<2> {
\begin{figure}[tb]
\centering
\begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
    ]

  \node[red_node,label=above:{\footnotesize$2$}] (A) at (0,0) {\footnotesize$s_0$};
  \node[red_node,label=above:{\footnotesize$3$}] (B) at (-1.7,-1) {\footnotesize$s_{1}$};
  \node[red_node,label=above:{\footnotesize$1$}] (C) at (1.7,-1) {\footnotesize$s_{2}$};
  \node[black_node,label=above:{\footnotesize$4$}] (D) at (-2.7,-2) {\footnotesize$s_{3}$};
  \node[black_node,label=above:{\footnotesize$4$}] (E) at (-0.7,-2) {\footnotesize$s_{4}$};
  \node[black_node,label=above:{\footnotesize$2$}] (F) at (0.7,-2) {\footnotesize$s_{5}$};
  \node[black_node, accepting,label=above:{\footnotesize$0$}] (G) at (2.7,-2) {\footnotesize$s^{*}$};

  \draw[red] (A) -- (B);
  \draw[red] (A) -- (C);
  \draw (B) -- (D);
  \draw (B) -- (E);
  \draw (C) -- (F);
  \draw (C) -- (G);
\end{tikzpicture}
\end{figure}

\begin{table}[b]
\centering
\begin{tabular}{|c|c|}
\hline
\textbf{Iteração} & \textbf{Fila de Prioridades} \\
\hline
0 & $\cancel{(s_{0}, 2)}$ \\
\hline
1 & $(s_{2}, 1)$ \quad $(s_{1}, 3)$ \\
\hline
\end{tabular}
\end{table}
}

\only<3> {
\begin{figure}[b]
\centering
\begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
    ]

  \node[black_node,label=above:{\footnotesize$2$}] (A) at (0,0) {\footnotesize$s_0$};
  \node[black_node,label=above:{\footnotesize$3$}] (B) at (-1.7,-1) {\footnotesize$s_{1}$};
  \node[red_node,label=above:{\footnotesize$1$}] (C) at (1.7,-1) {\footnotesize$s_{2}$};
  \node[black_node,label=above:{\footnotesize$4$}] (D) at (-2.7,-2) {\footnotesize$s_{3}$};
  \node[black_node,label=above:{\footnotesize$4$}] (E) at (-0.7,-2) {\footnotesize$s_{4}$};
  \node[red_node,label=above:{\footnotesize$2$}] (F) at (0.7,-2) {\footnotesize$s_{5}$};
  \node[red_node, accepting,label=above:{\footnotesize$0$}] (G) at (2.7,-2) {\footnotesize$s^{*}$};

  \draw[gray] (A) -- (B);
  \draw[gray] (A) -- (C);
  \draw (B) -- (D);
  \draw (B) -- (E);
  \draw[red] (C) -- (F);
  \draw[red] (C) -- (G);
\end{tikzpicture}
\end{figure}

\begin{table}[b]
\centering
\begin{tabular}{|c|c|}
\hline
\textbf{Iteração} & \textbf{Fila de Prioridades} \\
\hline
0 & ($s_{0}$, 2) \\
\hline
1 & $\cancel{(s_{2}, 1)}$ \quad $(s_{1}, 3)$ \\
\hline
2 & $(s^{*}, 0)$ \quad $(s_{5}, 2)$ \quad $(s_{1}, 3)$ \\
\hline
\end{tabular}
\end{table}
}

\only<4> {
\begin{figure}[b]
\centering
\begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
    ]

  \node[black_node,label=above:{\footnotesize$2$}] (A) at (0,0) {\footnotesize$s_0$};
  \node[black_node,label=above:{\footnotesize$3$}] (B) at (-1.7,-1) {\footnotesize$s_{1}$};
  \node[black_node,label=above:{\footnotesize$1$}] (C) at (1.7,-1) {\footnotesize$s_{2}$};
  \node[black_node,label=above:{\footnotesize$4$}] (D) at (-2.7,-2) {\footnotesize$s_{3}$};
  \node[black_node,label=above:{\footnotesize$4$}] (E) at (-0.7,-2) {\footnotesize$s_{4}$};
  \node[black_node,label=above:{\footnotesize$2$}] (F) at (0.7,-2) {\footnotesize$s_{5}$};
  \node[red_node, accepting,label=above:{\footnotesize$0$}] (G) at (2.7,-2) {\footnotesize$s^{*}$};

  \draw[gray] (A) -- (B);
  \draw[red] (A) -- (C);
  \draw (B) -- (D);
  \draw (B) -- (E);
  \draw[gray] (C) -- (F);
  \draw[red] (C) -- (G);
\end{tikzpicture}
\end{figure}

\begin{table}[tb]
\centering
\begin{tabular}{|c|c|}
\hline
\textbf{Iteração} & \textbf{Fila de Prioridades} \\
\hline
0 & $(s_{0}, 2)$ \\
\hline
1 & $(s_{2}, 1)$ \quad $(s_{1}, 3)$ \\
\hline
2 & $\cancel{(s^{*}, 0)}$ \quad $(s_{5}, 2)$ \quad $(s_{1}, 3)$ \\
\hline
3 & $(s_{5}, 2)$ \quad $(s_{1}, 3)$ \\
\hline
\end{tabular}
\end{table}
}

\end{frame}

\subsection{Operadores Preferidos}
\begin{frame}{Operadores Preferidos}
\begin{itemize}
\item \alert{Operadores} considerados \alert{promissores} ``por alguma razão''.
    \pause
  \begin{itemize}
  \item A definição não é fechada, mas tipicamente isso quer dizer ``operadores que levam a algum estado mais provável de satisfazer o gol''~(\cite{Helmert/2006,Richter.Helmert/2009}).
  \end{itemize}
  \pause
\item Usados em conjunto com funções heurísticas.
  \begin{itemize}
  \item Sozinhos, são equivalentes a políticas (policies).
  \end{itemize}
\pause
\item No Fast Downward: usados em esquema ``\alert{dual-queue}''.
  \begin{itemize}
  \item Uma fila para todos os estados gerados, outra para \alert{estados gerados exclusivamente via POs}.
  \item Expansão alternada, ou não (\alert{boosting}).
  \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Operadores Preferidos do FF~(\cite{Hoffmann.Nebel/2001})}
\begin{itemize}
\item Para um estado $s$, faz um grafo da tarefa de planejamento \alert{relaxada} (ignorando del-effects) e calcula a solução dessa tarefa.
\pause
\item Os operadores preferidos do estado $s$ é dado por $$O_{\text{pref}}(s) = \{o \mid \textblue{pre(o) \subseteq s}, \textgreen{add(o) \cap S_{1}^{*} \neq \emptyset} \}$$
i.e., \textblue{operadores aplicáveis} em $s$ que \textgreen{adicionam pelo menos um fato do gol} no primeiro nível da solução relaxada.
\end{itemize}
\end{frame}

\begin{frame}{Operadores Preferidos do FF~(\cite{Hoffmann.Nebel/2001})}
\only<1> {
\begin{tikzpicture}
    [
        node distance=23mm and 23mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={rectangle, draw=black!0, fill=black!0, very thick, minimum height=4mm, minimum width=4mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
    ]
  \node[black_node, label={[below, label distance = -37.5mm]:{$P_{0}$~($s_0$)}}] (p0) at (0,0) {%
    \begin{tabular}{c}
      \footnotesize on(c,a) \\
      \footnotesize on-table(a) \\
      \footnotesize on-table(b) \\
      \footnotesize clear(c) \\
      \footnotesize clear(b)
    \end{tabular}
  };

  \node[black_node, label={[below, label distance=-33mm]:{$A_{1}$}}] (a1) [right = of p0] {%
    \begin{tabular}{c}
      \footnotesize move(c,a,b) \\
      \footnotesize to-table(c,a) \\
      \footnotesize from-table(b,c)
    \end{tabular}
  };

  \node[black_node, label={[below, label distance=-45mm]:{$P_{1}$}}] (p1) [right = of a1] {%
    \begin{tabular}{c}
      \footnotesize on(c,b) \\
      \footnotesize clear(a) \\
      \footnotesize on-table(a) \\
      \footnotesize on-table(b) \\
      \footnotesize clear(c) \\
      \footnotesize on-table(c) \\
      \footnotesize on(b,c) \\
      \footnotesize clear(b)
    \end{tabular}
  };

  \node[black_node, label={[below, label distance=-28mm]:{$A_{t}$}}] (at) [right = of p1] {%
    \begin{tabular}{c}
      ...
    \end{tabular}
  };

  \node[black_node, label={[below, label distance=-28mm]:{$P_{t}$}}] (pt) [right = of at] {%
    \begin{tabular}{c}
      ...
    \end{tabular}
  };
\end{tikzpicture}

\begin{figure}[ht]
%\centering
\begin{tikzpicture}[scale=0.4]
  % Initial state
  \node[align=center] at (7.5,-0.3) {\footnotesize$s_{0}$};
  \drawCube{7}{0.5}{0}{\footnotesize A}{red}{0.7}
  \drawCube{7}{1.2}{0}{\footnotesize C}{green}{0.7}
  \drawCube{7.7}{0.5}{0}{\footnotesize B}{blue}{0.7}

  % Goal state
  \node[align=center] at (11.2,-0.3) {\footnotesize$s^{*}$};
  \drawCube{11}{0.5}{0}{\footnotesize B}{blue}{0.7}
  \drawCube{11}{1.2}{0}{\footnotesize C}{green}{0.7}
  \drawCube{11}{1.9}{0}{\footnotesize A}{red}{0.7}
\end{tikzpicture}
\end{figure}

}
\only<2> {
\begin{tikzpicture}
    [
        node distance=23mm and 23mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={rectangle, draw=black!0, fill=black!0, very thick, minimum height=4mm, minimum width=4mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
    ]
  \node[black_node, label={[below, label distance = -39.5mm]:{$P_{0}$~($s_0$)}}] (p0) at (0,0) {%
    \begin{tabular}{c}
      \footnotesize on(c,a) \\
      \footnotesize on-table(a) \\
      \footnotesize on-table(b) \\
      \footnotesize clear(c) \\
      \footnotesize clear(b)
    \end{tabular}
  };

  \node[black_node, label={[below, label distance=-35mm]:{$A_{1}$}}] (a1) [right = of p0] {%
    \begin{tabular}{c}
      \alert{\footnotesize move(c,a,b)} \\
      \footnotesize to-table(c,a) \\
      \footnotesize from-table(b,c)
    \end{tabular}
  };

  \node[black_node, label={[below, label distance=-47mm]:{$P_{1}$}}] (p1) [right = of a1] {%
    \begin{tabular}{c}
      \alert{\footnotesize on(c,b)} \\
      \footnotesize clear(a) \\
      \footnotesize on-table(a) \\
      \footnotesize on-table(b) \\
      \footnotesize clear(c) \\
      \footnotesize on-table(c) \\
      \footnotesize on(b,c) \\
      \footnotesize clear(b)
    \end{tabular}
  };

  \node[black_node, label={[below, label distance=-30mm]:{$A_{t}$}}] (at) [right = of p1] {%
    \begin{tabular}{c}
      ...
    \end{tabular}
  };

  \node[black_node, label={[below, label distance=-30mm]:{$P_{t}$}}] (pt) [right = of at] {%
    \begin{tabular}{c}
      ...
    \end{tabular}
  };
\end{tikzpicture}

\begin{columns}
\begin{column}{0.5\textwidth}

$$O_{\text{pref}}(s_{0}) = \{\text{move(c,a,b)}\}$$
\end{column}
\begin{column}{0.5\textwidth}
\begin{figure}[ht]
%\centering
\begin{tikzpicture}[scale=0.4]
  % Initial state
  \node[align=center] at (7.5,-0.3) {\footnotesize$s_{0}$};
  \drawCube{7}{0.5}{0}{\footnotesize A}{red}{0.7}
  \drawCube{7}{1.2}{0}{\footnotesize C}{green}{0.7}
  \drawCube{7.7}{0.5}{0}{\footnotesize B}{blue}{0.7}

  % Goal state
  \node[align=center] at (11.2,-0.3) {\footnotesize$s^{*}$};
  \drawCube{11}{0.5}{0}{\footnotesize B}{blue}{0.7}
  \drawCube{11}{1.2}{0}{\footnotesize C}{green}{0.7}
  \drawCube{11}{1.9}{0}{\footnotesize A}{red}{0.7}
\end{tikzpicture}
\end{figure}
\end{column}
\end{columns}
}
\end{frame}


\subsection{Aprendizado de Funções Heurísticas}
%\begin{frame}{Aprendizado de Funções Heurísticas}
%\begin{itemize}
%  \item Abordagem que depende \alert{muito} da lógica do domínio.
%    \begin{itemize}
%      \item Arquitetura da rede reflete a lógica do domínio.
%      \item e.g. (hyper)graph neural networks~(\cite{Shen.etal/2020,Stahlberg.etal/2022}), action schema networks~(\cite{Toyer.etal/2018,Toyer.etal/2020}).
%    \end{itemize}
%  \pause
%  \item Abordagem que depende \alert{pouco} da lógica do domínio.
%    \begin{itemize}
%      \item Apenas usa lógica do domínio para extrair mutexes e operadores aplicáveis durante a amostragem.
%      \item Rede neural simples, e.g., feedforward NN.
%      \item e.g.~\cite{Ferber.etal/2020a,Yu.etal/2020,Ferber.etal/2022,OToole/2022,Bettker.etal/2022}
%    \end{itemize}
%\end{itemize}
%\end{frame}

\begin{frame}{Aprendizado de Funções Heurísticas}
Em particular, este trabalho segue uma \alert{abordagem supervisionada} para o aprendizado de funções heurísticas e operadores preferidos.
\begin{itemize}
  \pause
  \item Uso de lógica do domínio apenas para a derivação de mutexes e operadores aplicáveis durante o processo de amostragem.
  \pause
  \item Rede neural simples, e.g., feedforward NN.
  \pause
  \item e.g.~\cite{Ferber.etal/2020a,Yu.etal/2020,Ferber.etal/2022,OToole/2022,Bettker.etal/2022}
  %\item e.g.~\firsttwo{Bettker.etal/2022}
  \pause
  \item Usamos a estratégia de \alert{\cite{Bettker.etal/2022}}.
\end{itemize}
\end{frame}

\begin{frame}{Gerando Amostras com \bfsrw de \cite{Bettker.etal/2022}}
\begin{itemize}
  \item A partir do gol, faz \alert{regressão} usando \alert{BFS} até conseguir $10\,\%$ do número de amostras $N$.
  \pause
  \item Obtém o restante das amostras fazendo rollouts de \alert{Random Walk} a partir dos \alert{estados-folha} do BFS.
\end{itemize}
\end{frame}

\iffalse
\begin{frame}{Melhorando as Estimativas das Amostras}
\begin{itemize}
  \item \textbf{\emph{Sample Improvement} (SAI)}:
  \begin{itemize}
    \item Para manter a consistência, \alert{estados repetidos} no conjunto de amostras ficam com o mesmo valor-$h$.
    \item $h(s) = \min\{h_i \mid s=s_i, i\in[N]\}$
  \end{itemize}
\end{itemize}
\pause
\begin{align*}
\centering
&\langle\text{valor-}h;\text{estado}\rangle \\
&\ldots \\
&\langle\alert{12};0000000101011111\ldots10000010000100000\rangle \\
&\ldots \\
\only<2>{&\langle\alert{14};0000000101011111\ldots10000010000100000\rangle \\}
\only<3>{&\langle\cancel{14}~\alert{12};0000000101011111\ldots10000010000100000\rangle \\}
&\ldots
\end{align*}
\end{frame}
\fi

\begin{frame}{Melhorando as Estimativas das Amostras Vizinhas}
\begin{itemize}
  \item \textbf{\emph{Successor Improvement} (SUI)}:
  \begin{itemize}
    \item Múltiplos rollouts podem gerar \alert{estados vizinhos}.
    \begin{itemize}
      \item Podemos usar essa informação para melhorar os valores-$h$.
    \end{itemize}
    \pause
    \item Faz um \alert{grafo} com todas as relações de predecessores e sucessores do conjunto de amostras.
    \pause
    \item Atualiza os valores-$h$ dos estados a \alert{um operador de distância}.
  \end{itemize}
\end{itemize}
 $$h(s) = \min(h(s), h(t)+1)$$
\end{frame}

\begin{frame}{Melhorando as Estimativas das Amostras Vizinhas}
\begin{columns}
\begin{column}{0.5\textwidth}
\only<1> {
    \begin{itemize}
        \item Rollout \#1
        \begin{itemize}
            \item $\langle s^*, 0 \rangle$
            \item $\langle s_1, 1 \rangle$
            \item $\langle s_2, 2 \rangle$
            \item $\langle s_3, 3 \rangle$
        \end{itemize}
    \end{itemize}
}
\only<2> {
    \begin{itemize}
        \item Rollout \#2
        \begin{itemize}
            \item $\langle s^*, 0 \rangle$
            \item $\langle s_4, 1 \rangle$
            \item $\langle s_5, 2 \rangle$
            \item $\langle s_3, 3 \rangle$
        \end{itemize}
    \end{itemize}
}
\only<3> {
    \begin{itemize}
        \item Rollout \#1
        \begin{itemize}
            \item $\langle s^*, 0 \rangle$
            \item $\langle s_1, 1 \rangle$
            \item $\langle s_2, 2 \rangle$
            \item $\langle s_3, 3 \rangle$
        \end{itemize}
        \item Rollout \#2
        \begin{itemize}
            \item $\langle s^*, 0 \rangle$
            \item $\langle s_4, 1 \rangle$
            \item $\langle s_5, 2 \rangle$
            \item $\langle s_3, 3 \rangle$
        \end{itemize}
    \end{itemize}
}
\only<4> {
    \begin{itemize}
        \item (1) Faz um grafo tal que $G=(V,A)$, i.e.,~$V=\{s_i\mid i\in[N]\}$.
        \item (2) Para todo par $s,t\in V$, adiciona um arco $(s,t)$ em $A$ caso $\text{succ}(s,o)\subseteq t$.
    \end{itemize}
}
\only<5> {
    \begin{itemize}
        \item (3) Atualiza as estimativas dos estados de acordo com os sucessores.
    \end{itemize}
}
\end{column}
\begin{column}{0.5\textwidth}
\only<1> {
    \begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
    ]
        \node[red_node, accepting, label=left:{\footnotesize$0$}] (goal) {\footnotesize$s^*$} ;
        \node[red_node, label=left:{\footnotesize$1$}] (s1) [below = of goal] {\footnotesize$s_{1}$} ;
        \node[red_node, label=left:{\footnotesize$2$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;
        \node[red_node, label=right:{\footnotesize$3$}] (s3) [right = of s2] {\footnotesize$s_{3}$} ;
        \draw[->, line width=0.3mm, color=red] (s1) -- (goal) ;
        \draw[->, line width=0.3mm, color=red] (s2) -- (s1) ;
        \draw[->, line width=0.3mm, color=red] (s3) -- (s2) ;
    \end{tikzpicture}
}
\only<2> {
    \begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        blue_node/.style={circle, draw=blue!100, fill=blue!0, very thick, minimum height=8mm, minimum width=8mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
        gray_node/.style={circle, draw=lightgray, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
    ]
        \node[red_node, accepting, label=left:{\footnotesize$0$}] (goal) {\footnotesize$s^*$} ;
        \node[gray_node, label=left:{\footnotesize$1$}] (s1) [below = of goal] {\footnotesize$s_{1}$} ;
        \node[gray_node, label=left:{\footnotesize$2$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;

        \node[red_node, label=right:{\footnotesize$1$}] (s4) [right = of goal] {\footnotesize$s_{4}$} ;
        \node[red_node, label=right:{\footnotesize$2$}] (s5) [below = of s4] {\footnotesize$s_{5}$} ;
        \node[red_node, label=right:{\footnotesize$3$}] (s3) [below = of s5] {\footnotesize$s_{3}$} ;


        \draw[->, line width=0.3mm, color=lightgray] (s1) -- (goal) ;
        \draw[->, line width=0.3mm, color=lightgray] (s2) -- (s1) ;
        \draw[->, line width=0.3mm, color=lightgray] (s3) -- (s2) ;

        \draw[->, line width=0.3mm, color=red] (s4) -- (goal) ;
        \draw[->, line width=0.3mm, color=red] (s5) -- (s4) ;
        \draw[->, line width=0.3mm, color=red] (s3) -- (s5) ;

    \end{tikzpicture}
}
\only<3> {
    \begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        red_node/.style={circle, draw=red!100, fill=red!0, very thick, minimum height=8mm, minimum width=8mm},
        blue_node/.style={circle, draw=blue!100, fill=blue!0, very thick, minimum height=8mm, minimum width=8mm},
        magenta_node/.style={circle, draw=magenta!100, fill=magenta!0, very thick, minimum height=8mm, minimum width=8mm},
    ]
        \node[black_node, accepting, label=left:{\footnotesize$0$}] (goal) {\footnotesize$s^*$} ;
        \node[black_node, label=left:{\footnotesize$1$}] (s1) [below = of goal] {\footnotesize$s_{1}$} ;
        \node[black_node, label=left:{\footnotesize$2$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;

        \node[black_node, label=right:{\footnotesize$1$}] (s4) [right = of goal] {\footnotesize$s_{4}$} ;
        \node[black_node, label=right:{\footnotesize$2$}] (s5) [below = of s4] {\footnotesize$s_{5}$} ;
        \node[black_node, label=right:{\footnotesize$3$}] (s3) [below = of s5] {\footnotesize$s_{3}$} ;

        \draw[->, line width=0.3mm, color=lightgray] (s1) -- (goal) ;
        \draw[->, line width=0.3mm, color=lightgray] (s2) -- (s1) ;
        \draw[->, line width=0.3mm, color=lightgray] (s3) -- (s2) ;

        \draw[->, line width=0.3mm, color=lightgray] (s4) -- (goal) ;
        \draw[->, line width=0.3mm, color=lightgray] (s5) -- (s4) ;
        \draw[->, line width=0.3mm, color=lightgray] (s3) -- (s5) ;
    \end{tikzpicture}
}
\only<4> {
    \begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        grey_node/.style={circle, draw=lightgray, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
    ]
        \node[black_node, accepting, label=left:{\footnotesize$0$}] (goal) {\footnotesize$s^*$} ;
        \node[black_node, label=left:{\footnotesize$1$}] (s1) [below = of goal] {\footnotesize$s_{1}$} ;
        \node[black_node, label=left:{\footnotesize$2$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;

        \node[black_node, label=right:{\footnotesize$1$}] (s4) [right = of goal] {\footnotesize$s_{4}$} ;
        \node[black_node, label=right:{\footnotesize$2$}] (s5) [below = of s4] {\footnotesize$s_{5}$} ;
        \node[black_node, label=right:{\footnotesize$3$}] (s3) [below = of s5] {\footnotesize$s_{3}$} ;

        \draw[->, line width=0.3mm, color=black] (s1) -- (goal) ;
        \draw[->, line width=0.3mm, color=black] (s2) -- (s1) ;
        \draw[->, line width=0.3mm, color=black] (s3) -- (s2) ;

        \draw[->, line width=0.3mm, color=black] (s4) -- (goal) ;
        \draw[->, line width=0.3mm, color=black] (s5) -- (s4) ;
        \draw[->, line width=0.3mm, color=black] (s3) -- (s5) ;

        \draw[->, line width=0.3mm, color=red] (s3) -- (s1) ;
    \end{tikzpicture}
}
\only<5> {
    \begin{tikzpicture}
    [
        node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
        black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
        grey_node/.style={circle, draw=lightgray, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
    ]
        \node[black_node, accepting, label=left:{\footnotesize$0$}] (goal) {\footnotesize$s^*$} ;
        \node[black_node, label=left:{\footnotesize$1$}] (s1) [below = of goal] {\footnotesize$s_{1}$} ;
        \node[black_node, label=left:{\footnotesize$2$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;

        \node[black_node, label=right:{\footnotesize$1$}] (s4) [right = of goal] {\footnotesize$s_{4}$} ;
        \node[black_node, label=right:{\footnotesize$2$}] (s5) [below = of s4] {\footnotesize$s_{5}$} ;
        \node[black_node, label=right:{\footnotesize$\text{\cancel{3}}\;\alert{2}$}] (s3) [below = of s5] {\footnotesize$s_{3}$} ;

        \draw[->, line width=0.3mm, color=black] (s1) -- (goal) ;
        \draw[->, line width=0.3mm, color=black] (s2) -- (s1) ;
        \draw[->, line width=0.3mm, color=black] (s3) -- (s2) ;

        \draw[->, line width=0.3mm, color=black] (s4) -- (goal) ;
        \draw[->, line width=0.3mm, color=black] (s5) -- (s4) ;
        \draw[->, line width=0.3mm, color=black] (s3) -- (s5) ;

        \draw[->, line width=0.3mm, color=black] (s3) -- (s1) ;
    \end{tikzpicture}
}
\end{column}
\end{columns}
\end{frame}

\section{Abordagem Proposta}
\begin{frame}{Como Aprender Operadores Preferidos?}
\begin{itemize}
  \item Ainda que POs sejam úteis, literatura sobre POs no geral é escassa, e sobre aprendizado de POs, inexistente.
  \pause
  \item A seguir, damos uma definição de \alert{operadores preferidos ideais},
  \pause
  \item mostramos \alert{como obter operadores preferidos} a partir de um conjunto de amostras, aproximando POs ideais,
  \pause
  \item e propomos um \alert{novo método de amostragem}.
\end{itemize}
\end{frame}

\subsection{Operadores Preferidos Ideais}
\begin{frame}{Operadores Preferidos Ideais}
\begin{itemize}
  \item Um operador preferido ideal gera um estado com a \alert{menor distância até o gol} entre todos os \alert{sucessores} de um estado $s$.
  \pause
  \item Dado um estado $s$ e um operador $o \in \mathcal{O}$ em que $\sucs(s,o) = t$, $o$ é considerado um operador preferido ideal se $\hstarp{t} = \min_{s' \in \sucs(s)} \hstarp{s'}$.
  \begin{itemize}
    \item $\hstarp{t} < \hstarp{s}$
  \end{itemize}
\end{itemize}
\centering
\pause
\vspace{0.6cm}
\begin{tikzpicture}
[
    node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
    black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
    grey_node/.style={circle, draw=lightgray, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
]
    \node[black_node, label=above:{\footnotesize$5$}] (s) {\footnotesize$s$} ;
    \node[black_node, label=above:{\footnotesize$6$}] (s1) [right = of s] {\footnotesize$s_{1}$} ;
    \node[black_node, label=below:{\footnotesize$8$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;

    \node[black_node, label=below:{\footnotesize$4$}] (t) [below = of s] {\footnotesize$t$} ;
    \node[black_node, label=below:{\footnotesize$10$}] (s3) [left = of t] {\footnotesize$s_{3}$} ;
    \node[black_node, label=above:{\footnotesize$22$}] (s4) [left = of s] {\footnotesize$s_{4}$} ;

    \draw[->, line width=0.3mm, color=red] (s) -- (t) node[midway,right] {\alert{\footnotesize$o_{t}$}} ;
    \draw[->, line width=0.3mm, color=black] (s) -- (s1) node[midway,above] {\footnotesize$o_{1}$} ;
    \draw[->, line width=0.3mm, color=black] (s) -- (s2) node[midway,right] {\footnotesize$o_{2}$} ;
    \draw[->, line width=0.3mm, color=black] (s) -- (s3) node[midway,left] {\footnotesize$o_{3}$} ;
    \draw[->, line width=0.3mm, color=black] (s) -- (s4) node[midway,above] {\footnotesize$o_{4}$} ;
\end{tikzpicture}
\end{frame}

\subsection{Operadores Preferidos Descobertos}
\begin{frame}{Operadores Preferidos Descobertos}
\begin{itemize}
  \item A realidade é que \alert{não temos acesso ao espaço de estados completo} com \hstar.
  \pause
  \item Para treinar redes neurais, o que temos é um \alert{conjunto de amostras} do espaço de estados com \alert{estimativas imperfeitas}.
  \pause
  \item Precisamos ``descobrir'' os operadores preferidos dentro desse conjunto de amostras.
\end{itemize}
\end{frame}

\begin{frame}{Grafo de Caminhos Mais Curtos}
\begin{itemize}
  \item Dado um grafo $G$ representando um \alert{conjunto de amostras} e suas relações de sucessores e predecessores, podemos calcular o(s) \alert{caminho(s) mais curto de cada estado} (vértice) $s$ até o gol $s^{*}$.
  \begin{itemize}
    \item $\sucs(s, o) = t$ é representado por $s \xrightarrow{o} t$.
  \end{itemize}
  \pause
  \item Os \alert{arcos saintes} de $s$ que \alert{fazem parte de um caminho mais curto} para o gol são os \alert{operadores preferidos} de $s$.
\end{itemize}
\end{frame}

\begin{frame}{Grafo de Caminhos Mais Curtos}
\begin{columns}
\begin{column}{0.5\textwidth}
\only<1>{Grafo $G$.}
\only<2>{Grafo $G'$ de caminhos mais curtos para $s^{*}$.
  \begin{itemize}
    \item Mantém só os arcos que levam ao(s) caminho(s) mais curto(s) de qualquer estado para $s^{*}$.
  \end{itemize}
}
\only<3>{Por exemplo, para o estado $s_{3}$, o operador \alert{$o_{7}$} é um \alert{operador preferido}.}
\end{column}
\begin{column}{0.5\textwidth}
\only<1>{
\begin{tikzpicture}
[
    node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
    black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
    grey_node/.style={circle, draw=lightgray, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
]
    \node[black_node, accepting, label=left:{\footnotesize$0$}] (goal) {\footnotesize$s^*$} ;
    \node[black_node, label=left:{\footnotesize$1$}] (s1) [below = of goal] {\footnotesize$s_{1}$} ;
    \node[black_node, label=left:{\footnotesize$2$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;

    \node[black_node, label=right:{\footnotesize$1$}] (s4) [right = of goal] {\footnotesize$s_{4}$} ;
    \node[black_node, label=right:{\footnotesize$2$}] (s5) [below = of s4] {\footnotesize$s_{5}$} ;
    \node[black_node, label=right:{\footnotesize$2$}] (s3) [below = of s5] {\footnotesize$s_{3}$} ;

    \draw[->, line width=0.3mm, color=black] (s1) -- (goal) node[midway,left] {\footnotesize$o_{1}$} ;
    \draw[->, line width=0.3mm, color=black] (s2) -- (s1) node[midway,left] {\footnotesize$o_{2}$} ;
    \draw[->, line width=0.3mm, color=black] (s3) -- (s2) node[midway,below] {\footnotesize$o_{3}$} ;
    \draw[->, line width=0.3mm, color=black] (s4) -- (goal) node[midway,above] {\footnotesize$o_{4}$} ;
    \draw[->, line width=0.3mm, color=black] (s5) -- (s4) node[midway,right] {\footnotesize$o_{5}$} ;
    \draw[->, line width=0.3mm, color=black] (s3) -- (s5) node[midway,right] {\footnotesize$o_{6}$} ;
    \draw[->, line width=0.3mm, color=black] (s3) -- (s1) node[midway,above] {\footnotesize$o_{7}$} ;
\end{tikzpicture}
}
\only<2>{
\begin{tikzpicture}
[
    node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
    black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
    grey_node/.style={circle, draw=lightgray, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
]
    \node[black_node, accepting, label=left:{\footnotesize$0$}] (goal) {\footnotesize$s^*$} ;
    \node[black_node, label=left:{\footnotesize$1$}] (s1) [below = of goal] {\footnotesize$s_{1}$} ;
    \node[black_node, label=left:{\footnotesize$2$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;

    \node[black_node, label=right:{\footnotesize$1$}] (s4) [right = of goal] {\footnotesize$s_{4}$} ;
    \node[black_node, label=right:{\footnotesize$2$}] (s5) [below = of s4] {\footnotesize$s_{5}$} ;
    \node[black_node, label=right:{\footnotesize$2$}] (s3) [below = of s5] {\footnotesize$s_{3}$} ;

    \draw[->, line width=0.3mm, color=black] (s1) -- (goal) node[midway,left] {\footnotesize$o_{1}$} ;
    \draw[->, line width=0.3mm, color=black] (s2) -- (s1) node[midway,left] {\footnotesize$o_{2}$} ;
    \draw[->, line width=0.3mm, color=lightgray] (s3) -- (s2) node[midway,below] {\footnotesize$o_{3}$} ;
    \draw[->, line width=0.3mm, color=black] (s4) -- (goal) node[midway,above] {\footnotesize$o_{4}$} ;
    \draw[->, line width=0.3mm, color=black] (s5) -- (s4) node[midway,right] {\footnotesize$o_{5}$} ;
    \draw[->, line width=0.3mm, color=lightgray] (s3) -- (s5) node[midway,right] {\footnotesize$o_{6}$} ;
    \draw[->, line width=0.3mm, color=black] (s3) -- (s1) node[midway,above] {\footnotesize$o_{7}$} ;
\end{tikzpicture}
}
\only<3>{
\begin{tikzpicture}
[
    node distance=21mm and 22mm, on grid, auto, label distance=-0.5mm,
    black_node/.style={circle, draw=black!100, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
    grey_node/.style={circle, draw=lightgray, fill=black!0, very thick, minimum height=8mm, minimum width=8mm},
]
    \node[black_node, accepting, label=left:{\footnotesize$0$}] (goal) {\footnotesize$s^*$} ;
    \node[black_node, label=left:{\footnotesize$1$}] (s1) [below = of goal] {\footnotesize$s_{1}$} ;
    \node[black_node, label=left:{\footnotesize$2$}] (s2) [below = of s1] {\footnotesize$s_{2}$} ;

    \node[black_node, label=right:{\footnotesize$1$}] (s4) [right = of goal] {\footnotesize$s_{4}$} ;
    \node[black_node, label=right:{\footnotesize$2$}] (s5) [below = of s4] {\footnotesize$s_{5}$} ;
    \node[black_node, label=right:{\footnotesize$2$}] (s3) [below = of s5] {\footnotesize$s_{3}$} ;

    \draw[->, line width=0.3mm, color=black] (s1) -- (goal) node[midway,left] {\footnotesize$o_{1}$} ;
    \draw[->, line width=0.3mm, color=black] (s2) -- (s1) node[midway,left] {\footnotesize$o_{2}$} ;
    \draw[->, line width=0.3mm, color=lightgray] (s3) -- (s2) node[midway,below] {\footnotesize$o_{3}$} ;
    \draw[->, line width=0.3mm, color=black] (s4) -- (goal) node[midway,above] {\footnotesize$o_{4}$} ;
    \draw[->, line width=0.3mm, color=black] (s5) -- (s4) node[midway,right] {\footnotesize$o_{5}$} ;
    \draw[->, line width=0.3mm, color=lightgray] (s3) -- (s5) node[midway,right] {\footnotesize$o_{6}$} ;
    \draw[->, line width=0.3mm, color=red] (s3) -- (s1) node[midway,above] {\footnotesize$o_{7}$} ;
\end{tikzpicture}
}


\end{column}
\end{columns}

\end{frame}

\subsection{Gerando Amostras com \bfsrs}
\begin{frame}{Gerando Amostras com \bfsrs}
\begin{itemize}
  \item Método de \cite{Bettker.etal/2022} (\bfsrw) gera muitas \alert{amostras repetidas}.
  \begin{itemize}
    \item Essas amostras repetidas são inúteis para a construção do grafo de caminho mais curto.
    \item Logo, ``perdemos a chance'' de descobrir mais operadores preferidos.
  \end{itemize}
  \pause
  \item Regressão via ``\alert{Expansions from Random Successors}'' (\alert{\bfsrs}).
\end{itemize}
\end{frame}

\begin{frame}{Gerando Amostras com \bfsrs}
\begin{itemize}
  \item Gera $10\,\%$ das amostras via \alert{BFS}.
  \begin{itemize}
    \item Isso popula a fila \alert{$open$}, que contém estados gerados mas não expandidos, e conjunto \alert{$closed$}, com estados já amostrados.
  \end{itemize}
  \pause
  \item Gera o restante das amostas \alert{expandindo sucessores aleatoriamente}:
  \begin{itemize}
    \item Pega um estado $s \in open$.
    \pause
    \item Expande $s$ e coloca seus sucessores $s' \in \sucs(s)$ em $open$ se $s' \notin closed$.
    \pause
    \item Coloca $s$ em $closed$.
  \end{itemize}
\pause
\vspace{1.0cm}
Depois, melhoramos as estimativas com SAI e SUI, extraímos os operadores preferidos, e completamos os estados.
\end{itemize}
\end{frame}


\section{Experimentos}
\subsection{Preliminares}
\begin{frame}{Perguntas}
\begin{itemize}
  \only<1>{\item Conseguimos diminuir o número de estados expandidos usando a \alert{nossa abordagem} com uma \alert{heurística aprendida}? E como a nossa abordagem se \alert{compara} com os operadores preferidos \alert{ideais}?}
  \only<2>{\item O que acontece se \alert{aumentarmos o tamanho do nosso conjunto de amostras} para treinamemento? Melhoramos? Se sim, até quanto?
    \begin{itemize}
      \item Aliás: somos melhores que os operadores preferidos do \alert{FF}?
    \end{itemize}}
  \only<3>{\item E se usarmos o método de amostragem de \alert{\cite{Bettker.etal/2022}} para descobrir operadores preferidos? É \alert{melhor ou pior} do que a abordagem proposta?}
  \only<4>{\item Nossos operadores preferidos continuam sendo úteis usando com \alert{heurísticas lógicas}? ``Ganhamos'' dos operadores preferidos do FF?}
\end{itemize}
\end{frame}

\begin{frame}{Configuração}
\begin{itemize}
  \item Geração de amostras
  \begin{itemize}
    \item Neural Fast Downward~(\cite{Ferber.etal/2020a}).
  \end{itemize}
  \item Redes neurais
  \begin{itemize}
    \item PyTorch 1.9.0~(\cite{Paszke/2019}).
  \end{itemize}
  \item Máquinas Ubuntu~$20.04$~LTS~GNU/Linux
  \begin{itemize}
    \item AMD~Ryzen~$9$~$3900$X $12$-core ($4.2$~GHz).
    \item Limites de $4$~GB RAM e um núcleo por processo.
  \end{itemize}
\end{itemize}
\begin{figure}[tb]
    \centering
    \includegraphics[width=10cm]{img/resnet.png}
    %\caption{Uma tarefa de planejamento do domínio Blocks World.}
\end{figure}

\end{frame}


\begin{frame}{Tarefas de Benchmark}
\input{tables/tasks_info.tex}
\end{frame}

\begin{frame}{Geração de Amostras (Operadores Preferidos)}
\begin{itemize}
  \only<1,2,3>{\item Amostragem usando \alert{\bfsrs} a partir do gol de uma tarefa de cada domínio.
  \pause
  \item Geramos $N$ amostras, onde $N$ é a porcentagem do tamanho do espaço de estados de cada tarefa.
    \begin{itemize}
      \item e.g. em Blocks, $5\,\%$ é $\lceil 65990 \times 0.05 \rceil = 3300$ amostras.
    \end{itemize}
  \pause
  \item Para cada tarefa, geramos \alert{$5$} conjuntos de amostras (\emph{seeds}).
  \pause
  }
  \only<4>{
  \item Formato de cada amostra para a rede de \alert{valores-$h$} (\alert{FSM}):
    \begin{itemize}
      \item $\langle\textgreen{h(s)}, \textblue{\mathcal{F}(s)}\rangle$
      \item $\langle\textgreen{15};\textblue{000000011110\ldots000100000001}\rangle$
    \end{itemize}
  \vspace{0.5cm}
  \item Formato de cada amostra para a rede de \alert{POs} (\alert{XRS}):
    \begin{itemize}
      \item $\langle\textblue{\mathcal{F}(s)}, \textorange{O_{pref} \subseteq O}\rangle$
      \item $\langle\textblue{000000011110\ldots000100000001};\textorange{27,26}\rangle$
    \end{itemize}
  }
\end{itemize}
\end{frame}

\begin{frame}{Treinamento}
\begin{itemize}
  \item Duas redes treinadas separadamente: \alert{regressão} com mean squared error (MSE) para funções heurísticas, \alert{classificação} com binary cross-entropy (BCE) para POs.
  \pause
  \item $5$ net seeds ($= 5~\text{net seeds} \times 5~\text{sample seeds} = 25~\text{seeds}~\text{por tarefa}$).
  \pause
  \item Treino até \alert{early-stop} de 100 épocas. %(o treino mais longo durou~$2$h).
\end{itemize}

\pause
\begin{figure}[tb]
\caption[]{Tensor de saída de exmplo, com dois POs como ``target''.}
\centering
\begin{tikzpicture}[node distance=1cm]
  % Operators
  %\foreach \x in {1,...,10}
  %  \node[draw, minimum width=1cm, minimum height=0.5cm] (op\x) at (\x,0) {$o_{\x}$};
  \foreach \x in {1,...,10}{
    \ifnum\x=2
      \node[draw, minimum width=1cm, minimum height=0.5cm, fill=mygreen!30] (op\x) at (\x,0) {$o_{\x}$};
    \else
      \ifnum\x=5
        \node[draw, minimum width=1cm, minimum height=0.5cm, fill=mygreen!30] (op\x) at (\x,0) {$o_{\x}$};
      \else
        \node[draw, minimum width=1cm, minimum height=0.5cm] (op\x) at (\x,0) {$o_{\x}$};
      \fi
    \fi
  }
  % Sampled state
  \node[draw, minimum width=1cm, minimum height=0.5cm, above=of op2] (s) {Entrada $\mathcal{F}(s)$};

  % Arrows
  \draw[->] (s) -- (op2);
  \draw[->] (s) -- (op5);
\end{tikzpicture}
\label{fig:po-tensor}
\end{figure}

\end{frame}

\begin{frame}{Teste (Busca)}
\begin{itemize}
  \item Para cada tarefa original, \alert{$50$ tarefas de teste} geradas via passeio aleatório a partir do estado inicial.
  \pause
  \item Buscas utilizando o GBFS implementado no Fast Downward, com limite de \alert{$5$ minutos} por tarefa.
  \pause
  \item Valor de \alert{boosting 1000}.
  \pause
  \item Todas as tarefas têm cobertura total mesmo com busca cega, então o parâmetro de comparação escolhido é o \alert{número de estados expandidos}.
\end{itemize}
\end{frame}

\begin{frame}{Legenda}
\begin{multicols}{3}
\begin{itemize}
  \item \hstar
    \begin{itemize}
      \item heurística perfeita
    \end{itemize}
  \item \hnn
    \begin{itemize}
      \item heurística aprendida
    \end{itemize}
  \item \postartable
    \begin{itemize}
      \item POs ideais (oráculo)
    \end{itemize}
  \item \postar
    \begin{itemize}
      \item POs ideais (NN)
    \end{itemize}
  %\item \pogstar
  %  \begin{itemize}
  %    \item POs descobertos (\hstar)
  %  \end{itemize}
  \item \alert{\pog}
    \begin{itemize}
      \item POs descobertos (NN)
    \end{itemize}

\end{itemize}
\end{multicols}
\end{frame}

\subsection{Aprendendo Operadores Preferidos}
\begin{frame}{Conseguimos Aprender Algo?}
\input{tables/learning_perfect_pos.tex}
\pause
\begin{itemize}
\item Os POs ideais \postartable e \postar aproximam-se de \hstar.
\pause
\item Os POs descobertos \pog expandem o dobro de \hstar, mas superam uma busca só com a heurística aprendida \hnn.
\pause
  \begin{itemize}
    \item Então sim: POs não são um delírio, e \alert{conseguimos aprender algo útil} mesmo treinando sobre amostras representando \alert{$1\,\%$ do espaço de estados}.
  \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{E Treinando com Mais Amostras?}
\input{tables/learning_discovered_pos.tex}
\begin{itemize}
  \item Melhora, mas os ganhos são menores a partir de $20\,\% - 30\,\%$.
  \pause
  \item Com um número de amostras equivalente a \alert{$5\,\%$} do espaço de estados, \alert{superamos \poff} em número de expansões.
\end{itemize}
\end{frame}

\subsection{Comparando \bfsrs e \bfsrw}
\begin{frame}{\bfsrs vs. \bfsrw}
\input{tables/comparison_sample.tex}
\begin{itemize}
  \item Em média, \pog \alert{tem menos expansões do que} \pofsm.
  \pause
  \item \pofsm \alert{precisa de $10\times$ mais amostras} para ter resultados comparáveis a \pog.
    \begin{itemize}
      \item \pofsm $50\,\%$: $22.5$.
      \item \pog $5\,\%$: $22.4$.
    \end{itemize}
\end{itemize}
\end{frame}

\subsection{Operadores Preferidos com Funções Heurísticas Lógicas}
\begin{frame}{Operadores Preferidos com Heurísticas Lógicas}
\input{tables/logic_heuristics_1pct.tex}
\begin{itemize}
  \only<1,2>{\item \pog \alert{tem menos expansões do que} \poff em todos os casos.
  \pause
  \item Usar bons POs pode ser \alert{melhor} do que trocar de função heurística.
    \begin{itemize}
       \item \hgc + \pog tem expansões próximas de \hff e \hadd.
    \end{itemize}
  }
    \only<3>{\item \hblind apenas \alert{identifica o gol}, sendo inútil para guiar a busca.
    \begin{itemize}
      \item Neste caso, os operadores preferidos atuam como uma \alert{política}. Os resultados mostram que \poff não serve efetivamente como uma política, enquanto \pog sim.
    \end{itemize}
    }
\end{itemize}
\end{frame}


\section{Conclusão}
\begin{frame}{Conclusão}
\begin{itemize}
  %\item Abordagens ``learning-based'' têm considerável potencial para superar abordagens ``logic-based''.
  \item É possível aprender operadores preferidos \alert{comparáveis ao estado da arte} ($\poff$, ~\cite{Hoffmann.Nebel/2001,Helmert/2006,Richter.Helmert/2009}).
  \pause
  \item POs aprendidos \pog têm \alert{menos expansões} do que \poff nas tarefas de teste.
  \pause
    \begin{itemize}
      \item Isso é mais evidente quando a heurística usada é menos informada (\hgc, \hblind).
      \pause
      \item Mas treinar sobre $5\,\%$ do espaço de estados para superar \poff ainda exige um número considerável de amostras.
      \pause
      \item Aprender POs é uma tarefa \alert{difícil}.
    \end{itemize}
  \pause
  \item Dado um conjunto com número de amostras representando uma porcentagem do espaço de estados, POs aprendidos \alert{generalizam bem} para o espaço de estados completo de uma tarefa.
\end{itemize}
\end{frame}

\begin{frame}[allowframebreaks]
\frametitle{Referências}
\printbibliography
\end{frame}

\end{document}
